import{m as We,o as Je,p as Ye,W as Qe,q as Ze,r as et,s as tt,v as st,w as nt,x as rt,y as ot,z as it,A as at,B as ct,G as lt,H as ut,I as dt,J as ft,L as ue,V as $,K as ht,N as pt,Q as mt,S as gt,T as de,U as Tt,X as _t,Y as xt,Z as St,_ as Rt,$ as Et,a0 as yt,a1 as wt,c as fe,g as Mt,n as W,a2 as At,a9 as he,a5 as Lt,a7 as bt,a3 as Ct,ab as It,a4 as vt,an as ve,E as Nt}from"./texture-635886dc.js";import{X as Ot,Y as O,Z as Ne,l as y,_ as Ft,q as Pt,$ as Dt,c as B,a0 as F,a1 as P,j as Oe,a2 as Ut,a3 as kt,a4 as Ht,a5 as Gt,J as pe,a6 as Fe,a7 as Pe,a8 as ee,y as jt,a9 as Y,L as Kt,r as oe,D as Bt,aa as Vt,d as $t,ab as zt,e as qt,H as Xt,g as Wt,ac as Jt,v as Yt,ad as Q,P as Qt,ae as Zt,O as es,I as De,af as ts,ag as ss,b as ns,M as Ue,ah as rs,ai as ke,aj as os,ak as is,al as as,am as cs,an as ls,ao as us,a as ds,ap as fs,aq as hs,ar as me,as as ps,at as ms,au as ge,av as gs,V as X,aw as Ts,ax as _s,ay as xs,Q as Ss}from"./three-ea07d844.js";class Rs extends We{constructor(){super();for(const e of Object.values(Je))this.registModule(e);for(const e of Object.values(Ye))this.resourceManager.addParser(new e);this.install(Qe({antialias:!0,alpha:!0})).install(Ze()).install(et()).install(tt({MSAA:!0})).install(st()).install(nt()),this.exec(rt()).exec(ot()).exec(it()).exec(at()).exec(ct()).exec(lt()).exec(ut()).exec(dt()).exec(ft())}}class Es{constructor(){this.map=new Map,this.cacheComponent={},this.cachePkg={}}async loadList(e=[]){return await Promise.all(e.map(t=>this.load(t)))}async load(e,t){if(this.cacheComponent[e])return this.cacheComponent[e];t.importmap?await ue(t,"custom",t.importmap):await ue(t);const s=await new Promise((r,n)=>{window.importShim(e).then(o=>{r(o.default)}).catch(o=>{n(o)})});return this.cacheComponent[e]=s,this.cachePkg[e]=t,s}async generate(e,t,s){const r=await this.load(e,t),n=document.createElement("div");n.style.width="100%",n.style.height="100%",n.style.position="absolute",n.style.overflow="hidden",document.body.appendChild(n);const o=document.createElement("div");n.appendChild(o);const c=$.extend(r),i=new c({el:o,data(){return JSON.parse(JSON.stringify(Object.assign(r.data(),s,{$url:e})))}});return this.map.set(s.$cid,i),{resource:n,config:i._data,packageJSON:t}}register(e,t){this.map.set(e,t)}get(e){return this.map.get(e)}remove(e){if(this.map.has(e)){const t=this.map.get(e);this.map.delete(e),t.$distory&&t.$distory()}}exportConfig(){const e=[];for(const t of this.map.values()){const s=this.cachePkg[t._data.$url];if(!s){console.warn(`can not found pkg in componentManager: ${t._data.$url}`);continue}const r={$cid:t._data.$cid,$url:t._data.$url};s.configuration.forEach(n=>{r[n.name]=t[n.name]}),e.push(JSON.parse(JSON.stringify(r)))}return e}}const ys=function(){let a,e,t;return{name:"ComponentManagerPlugin",deps:[...ht,pt,mt,gt],install(s){const r=new Es;s.componentManager=r,s.generateComponent=async function(n,o,c){const i=await this.componentManager.generate(n,o,c);return this.registerResources({[i.config.$cid]:i.resource}),i},e=s.loadConfigAsync,s.loadConfigAsync=async function(n){let o;n.component&&(o=await Promise.all(n.component.map(i=>this.generateComponent(i.$url,i.$pkg,i))));const c=await e.call(this,n);return c.component=o||[],c},a=s.exportConfig,s.exportConfig=function(n){const o=a.call(this,n),c=r.exportConfig();return o.component=c,o},t=s.getScreenshot,s.getScreenshot=async function(n){const o={width:this.dom.offsetWidth,height:this.dom.offsetHeight};!n.width&&(n.width=this.dom.offsetWidth),!n.height&&(n.height=this.dom.offsetHeight),!n.mine&&(n.mine="image/png");const c=document.createElement("canvas");c.setAttribute("width",n.width.toString()),c.setAttribute("height",n.height.toString());const i=c.getContext("2d");this.setSize(n.width,n.height);const u=await de(document.querySelector(".vis-css2D"),{backgroundColor:null}),d=await de(document.querySelector(".vis-css3D"),{backgroundColor:null}),l=await t.call(this,n);this.setSize(o.width,o.height);const f=new Image;return f.src=l,await new Promise((h,p)=>{f.onload=m=>{i.drawImage(m.target,0,0,n.width,n.height),i.drawImage(u,0,0,n.width,n.height),i.drawImage(d,0,0,n.width,n.height),h()}}),c.toDataURL(n.mine)}}}};class ws extends Ot{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Cs(t)}),this.register(function(t){return new Ds(t)}),this.register(function(t){return new Us(t)}),this.register(function(t){return new vs(t)}),this.register(function(t){return new Ns(t)}),this.register(function(t){return new Os(t)}),this.register(function(t){return new Fs(t)}),this.register(function(t){return new bs(t)}),this.register(function(t){return new Ps(t)}),this.register(function(t){return new Is(t)}),this.register(function(t){return new As(t)}),this.register(function(t){return new ks(t)})}load(e,t,s,r){const n=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=O.extractUrlBase(e),this.manager.itemStart(e);const c=function(u){r?r(u):console.error(u),n.manager.itemError(e),n.manager.itemEnd(e)},i=new Ne(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,function(u){try{n.parse(u,o,function(d){t(d),n.manager.itemEnd(e)},c)}catch(d){c(d)}},s,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,r){let n;const o={},c={};if(typeof e=="string")n=e;else if(O.decodeText(new Uint8Array(e,0,4))===He){try{o[g.KHR_BINARY_GLTF]=new Hs(e)}catch(l){r&&r(l);return}n=o[g.KHR_BINARY_GLTF].content}else n=O.decodeText(new Uint8Array(e));const i=JSON.parse(n);if(i.asset===void 0||i.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new Qs(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const l=this.pluginCallbacks[d](u);c[l.name]=l,o[l.name]=!0}if(i.extensionsUsed)for(let d=0;d<i.extensionsUsed.length;++d){const l=i.extensionsUsed[d],f=i.extensionsRequired||[];switch(l){case g.KHR_MATERIALS_UNLIT:o[l]=new Ls;break;case g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[l]=new Ks;break;case g.KHR_DRACO_MESH_COMPRESSION:o[l]=new Gs(i,this.dracoLoader);break;case g.KHR_TEXTURE_TRANSFORM:o[l]=new js;break;case g.KHR_MESH_QUANTIZATION:o[l]=new Bs;break;default:f.indexOf(l)>=0&&c[l]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}u.setExtensions(o),u.setPlugins(c),u.parse(s,r)}parseAsync(e,t){const s=this;return new Promise(function(r,n){s.parse(e,t,r,n)})}}function Ms(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}const g={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class As{constructor(e){this.parser=e,this.name=g.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,r=t.length;s<r;s++){const n=t[s];n.extensions&&n.extensions[this.name]&&n.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let r=t.cache.get(s);if(r)return r;const n=t.json,i=((n.extensions&&n.extensions[this.name]||{}).lights||[])[e];let u;const d=new y(16777215);i.color!==void 0&&d.fromArray(i.color);const l=i.range!==void 0?i.range:0;switch(i.type){case"directional":u=new Dt(d),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new Pt(d),u.distance=l;break;case"spot":u=new Ft(d),u.distance=l,i.spot=i.spot||{},i.spot.innerConeAngle=i.spot.innerConeAngle!==void 0?i.spot.innerConeAngle:0,i.spot.outerConeAngle=i.spot.outerConeAngle!==void 0?i.spot.outerConeAngle:Math.PI/4,u.angle=i.spot.outerConeAngle,u.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+i.type)}return u.position.set(0,0,0),u.decay=2,i.intensity!==void 0&&(u.intensity=i.intensity),u.name=t.createUniqueName(i.name||"light_"+e),r=Promise.resolve(u),t.cache.add(s,r),r}createNodeAttachment(e){const t=this,s=this.parser,n=s.json.nodes[e],c=(n.extensions&&n.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(i){return s._getNodeRef(t.cache,c,i)})}}class Ls{constructor(){this.name=g.KHR_MATERIALS_UNLIT}getMaterialType(){return B}extendParams(e,t,s){const r=[];e.color=new y(1,1,1),e.opacity=1;const n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const o=n.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}n.baseColorTexture!==void 0&&r.push(s.assignTexture(e,"map",n.baseColorTexture,F))}return Promise.all(r)}}class bs{constructor(e){this.parser=e,this.name=g.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name].emissiveStrength;return n!==void 0&&(t.emissiveIntensity=n),Promise.resolve()}}class Cs{constructor(e){this.parser=e,this.name=g.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:P}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&n.push(s.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&n.push(s.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(n.push(s.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const c=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Oe(c,c)}return Promise.all(n)}}class Is{constructor(e){this.parser=e,this.name=g.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:P}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&n.push(s.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&n.push(s.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(n)}}class vs{constructor(e){this.parser=e,this.name=g.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:P}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=[];t.sheenColor=new y(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&n.push(s.assignTexture(t,"sheenColorMap",o.sheenColorTexture,F)),o.sheenRoughnessTexture!==void 0&&n.push(s.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(n)}}class Ns{constructor(e){this.parser=e,this.name=g.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:P}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&n.push(s.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(n)}}class Os{constructor(e){this.parser=e,this.name=g.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:P}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=[],o=r.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&n.push(s.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||0;const c=o.attenuationColor||[1,1,1];return t.attenuationColor=new y(c[0],c[1],c[2]),Promise.all(n)}}class Fs{constructor(e){this.parser=e,this.name=g.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:P}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name];return t.ior=n.ior!==void 0?n.ior:1.5,Promise.resolve()}}class Ps{constructor(e){this.parser=e,this.name=g.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:P}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=[],o=r.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&n.push(s.assignTexture(t,"specularIntensityMap",o.specularTexture));const c=o.specularColorFactor||[1,1,1];return t.specularColor=new y(c[0],c[1],c[2]),o.specularColorTexture!==void 0&&n.push(s.assignTexture(t,"specularColorMap",o.specularColorTexture,F)),Promise.all(n)}}class Ds{constructor(e){this.parser=e,this.name=g.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,r=s.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const n=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,o)}}class Us{constructor(e){this.parser=e,this.name=g.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,r=s.json,n=r.textures[e];if(!n.extensions||!n.extensions[t])return null;const o=n.extensions[t],c=r.images[o.source];let i=s.textureLoader;if(c.uri){const u=s.options.manager.getHandler(c.uri);u!==null&&(i=u)}return this.detectSupport().then(function(u){if(u)return s.loadTextureImage(e,o.source,i);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class ks{constructor(e){this.name=g.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const r=s.extensions[this.name],n=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,o.ready]).then(function(c){const i=r.byteOffset||0,u=r.byteLength||0,d=r.count,l=r.byteStride,f=new ArrayBuffer(d*l),h=new Uint8Array(c[0],i,u);return o.decodeGltfBuffer(new Uint8Array(f),d,l,h,r.mode,r.filter),f})}else return null}}const He="glTF",j=12,Te={JSON:1313821514,BIN:5130562};class Hs{constructor(e){this.name=g.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,j);if(this.header={magic:O.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==He)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-j,r=new DataView(e,j);let n=0;for(;n<s;){const o=r.getUint32(n,!0);n+=4;const c=r.getUint32(n,!0);if(n+=4,c===Te.JSON){const i=new Uint8Array(e,j+n,o);this.content=O.decodeText(i)}else if(c===Te.BIN){const i=j+n;this.body=e.slice(i,i+o)}n+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Gs{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=g.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,r=this.dracoLoader,n=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,c={},i={},u={};for(const d in o){const l=se[d]||d.toLowerCase();c[l]=o[d]}for(const d in e.attributes){const l=se[d]||d.toLowerCase();if(o[d]!==void 0){const f=s.accessors[e.attributes[d]],h=V[f.componentType];u[l]=h,i[l]=f.normalized===!0}}return t.getDependency("bufferView",n).then(function(d){return new Promise(function(l){r.decodeDracoFile(d,function(f){for(const h in f.attributes){const p=f.attributes[h],m=i[h];m!==void 0&&(p.normalized=m)}l(f)},c,u)})})}}class js{constructor(){this.name=g.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class te extends oe{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),s=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),n=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),c={specular:{value:new y().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=c,this.onBeforeCompile=function(i){for(const u in c)i.uniforms[u]=c[u];i.fragmentShader=i.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",n).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return c.specular.value},set:function(i){c.specular.value=i}},specularMap:{get:function(){return c.specularMap.value},set:function(i){c.specularMap.value=i,i?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return c.glossiness.value},set:function(i){c.glossiness.value=i}},glossinessMap:{get:function(){return c.glossinessMap.value},set:function(i){c.glossinessMap.value=i,i?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Ks{constructor(){this.name=g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return te}extendParams(e,t,s){const r=t.extensions[this.name];e.color=new y(1,1,1),e.opacity=1;const n=[];if(Array.isArray(r.diffuseFactor)){const o=r.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(r.diffuseTexture!==void 0&&n.push(s.assignTexture(e,"map",r.diffuseTexture,F)),e.emissive=new y(0,0,0),e.glossiness=r.glossinessFactor!==void 0?r.glossinessFactor:1,e.specular=new y(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),r.specularGlossinessTexture!==void 0){const o=r.specularGlossinessTexture;n.push(s.assignTexture(e,"glossinessMap",o)),n.push(s.assignTexture(e,"specularMap",o,F))}return Promise.all(n)}createMaterial(e){const t=new te(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Ut,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class Bs{constructor(){this.name=g.KHR_MESH_QUANTIZATION}}class ie extends Ts{constructor(e,t,s,r){super(e,t,s,r)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,r=this.valueSize,n=e*r*3+r;for(let o=0;o!==r;o++)t[o]=s[n+o];return t}}ie.prototype.interpolate_=function(a,e,t,s){const r=this.resultBuffer,n=this.sampleValues,o=this.valueSize,c=o*2,i=o*3,u=s-e,d=(t-e)/u,l=d*d,f=l*d,h=a*i,p=h-i,m=-2*f+3*l,T=f-l,_=1-m,S=T-l+d;for(let x=0;x!==o;x++){const G=n[p+x+o],v=n[p+x+c]*u,w=n[h+x+o],R=n[h+x]*u;r[x]=_*G+S*v+m*w+T*R}return r};const Vs=new Ss;class $s extends ie{interpolate_(e,t,s,r){const n=super.interpolate_(e,t,s,r);return Vs.fromArray(n).normalize().toArray(n),n}}const b={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},V={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},_e={9728:os,9729:Fe,9984:is,9985:as,9986:cs,9987:Pe},xe={33071:ls,33648:us,10497:ee},Se={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},se={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},I={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},zs={CUBICSPLINE:void 0,LINEAR:De,STEP:ds},Z={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function qs(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new oe({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:fs})),a.DefaultMaterial}function K(a,e,t){for(const s in t.extensions)a[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function N(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Xs(a,e,t){let s=!1,r=!1,n=!1;for(let u=0,d=e.length;u<d;u++){const l=e[u];if(l.POSITION!==void 0&&(s=!0),l.NORMAL!==void 0&&(r=!0),l.COLOR_0!==void 0&&(n=!0),s&&r&&n)break}if(!s&&!r&&!n)return Promise.resolve(a);const o=[],c=[],i=[];for(let u=0,d=e.length;u<d;u++){const l=e[u];if(s){const f=l.POSITION!==void 0?t.getDependency("accessor",l.POSITION):a.attributes.position;o.push(f)}if(r){const f=l.NORMAL!==void 0?t.getDependency("accessor",l.NORMAL):a.attributes.normal;c.push(f)}if(n){const f=l.COLOR_0!==void 0?t.getDependency("accessor",l.COLOR_0):a.attributes.color;i.push(f)}}return Promise.all([Promise.all(o),Promise.all(c),Promise.all(i)]).then(function(u){const d=u[0],l=u[1],f=u[2];return s&&(a.morphAttributes.position=d),r&&(a.morphAttributes.normal=l),n&&(a.morphAttributes.color=f),a.morphTargetsRelative=!0,a})}function Ws(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let s=0,r=t.length;s<r;s++)a.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Js(a){const e=a.extensions&&a.extensions[g.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+Re(e.attributes):t=a.indices+":"+Re(a.attributes)+":"+a.mode,t}function Re(a){let e="";const t=Object.keys(a).sort();for(let s=0,r=t.length;s<r;s++)e+=t[s]+":"+a[t[s]]+";";return e}function ne(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Ys(a){return a.search(/\.jpe?g($|\?)/i)>0||a.search(/^data\:image\/jpeg/)===0?"image/jpeg":a.search(/\.webp($|\?)/i)>0||a.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class Qs{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Ms,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,n=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||s||r&&n<98?this.textureLoader=new kt(this.options.manager):this.textureLoader=new Ht(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ne(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,r=this.json,n=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(o){const c={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:s,userData:{}};K(n,c,r),N(c,r),Promise.all(s._invokeAll(function(i){return i.afterRoot&&i.afterRoot(c)})).then(function(){e(c)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let r=0,n=t.length;r<n;r++){const o=t[r].joints;for(let c=0,i=o.length;c<i;c++)e[o[c]].isBone=!0}for(let r=0,n=e.length;r<n;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(s[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const r=s.clone(),n=(o,c)=>{const i=this.associations.get(o);i!=null&&this.associations.set(c,i);for(const[u,d]of o.children.entries())n(d,c.children[u])};return n(s,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const r=e(t[s]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let r=0;r<t.length;r++){const n=e(t[r]);n&&s.push(n)}return s}getDependency(e,t){const s=e+":"+t;let r=this.cache.get(s);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(n){return n.loadMesh&&n.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(n){return n.loadBufferView&&n.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(n){return n.loadMaterial&&n.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(n){return n.loadTexture&&n.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(n){return n.loadAnimation&&n.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(n,o){return s.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[g.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(n,o){s.load(O.resolveURL(t.uri,r.path),n,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const r=t.byteLength||0,n=t.byteOffset||0;return s.slice(n,n+r)})}loadAccessor(e){const t=this,s=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0)return Promise.resolve(null);const n=[];return r.bufferView!==void 0?n.push(this.getDependency("bufferView",r.bufferView)):n.push(null),r.sparse!==void 0&&(n.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(n).then(function(o){const c=o[0],i=Se[r.type],u=V[r.componentType],d=u.BYTES_PER_ELEMENT,l=d*i,f=r.byteOffset||0,h=r.bufferView!==void 0?s.bufferViews[r.bufferView].byteStride:void 0,p=r.normalized===!0;let m,T;if(h&&h!==l){const _=Math.floor(f/h),S="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+_+":"+r.count;let x=t.cache.get(S);x||(m=new u(c,_*h,r.count*h/d),x=new Gt(m,h/d),t.cache.add(S,x)),T=new hs(x,i,f%h/d,p)}else c===null?m=new u(r.count*i):m=new u(c,f,r.count*i),T=new pe(m,i,p);if(r.sparse!==void 0){const _=Se.SCALAR,S=V[r.sparse.indices.componentType],x=r.sparse.indices.byteOffset||0,G=r.sparse.values.byteOffset||0,v=new S(o[1],x,r.sparse.count*_),w=new u(o[2],G,r.sparse.count*i);c!==null&&(T=new pe(T.array.slice(),T.itemSize,T.normalized));for(let R=0,D=v.length;R<D;R++){const U=v[R];if(T.setX(U,w[R*i]),i>=2&&T.setY(U,w[R*i+1]),i>=3&&T.setZ(U,w[R*i+2]),i>=4&&T.setW(U,w[R*i+3]),i>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return T})}loadTexture(e){const t=this.json,s=this.options,n=t.textures[e].source,o=t.images[n];let c=this.textureLoader;if(o.uri){const i=s.manager.getHandler(o.uri);i!==null&&(c=i)}return this.loadTextureImage(e,n,c)}loadTextureImage(e,t,s){const r=this,n=this.json,o=n.textures[e],c=n.images[t],i=(c.uri||c.bufferView)+":"+o.sampler;if(this.textureCache[i])return this.textureCache[i];const u=this.loadImageSource(t,s).then(function(d){d.flipY=!1,o.name&&(d.name=o.name);const f=(n.samplers||{})[o.sampler]||{};return d.magFilter=_e[f.magFilter]||Fe,d.minFilter=_e[f.minFilter]||Pe,d.wrapS=xe[f.wrapS]||ee,d.wrapT=xe[f.wrapT]||ee,r.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[i]=u,u}loadImageSource(e,t){const s=this,r=this.json,n=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(l=>l.clone());const o=r.images[e],c=self.URL||self.webkitURL;let i=o.uri||"",u=!1;if(o.bufferView!==void 0)i=s.getDependency("bufferView",o.bufferView).then(function(l){u=!0;const f=new Blob([l],{type:o.mimeType});return i=c.createObjectURL(f),i});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(i).then(function(l){return new Promise(function(f,h){let p=f;t.isImageBitmapLoader===!0&&(p=function(m){const T=new me(m);T.needsUpdate=!0,f(T)}),t.load(O.resolveURL(l,n.path),p,void 0,h)})}).then(function(l){return u===!0&&c.revokeObjectURL(i),l.userData.mimeType=o.mimeType||Ys(o.uri),l}).catch(function(l){throw console.error("THREE.GLTFLoader: Couldn't load texture",i),l});return this.sourceCache[e]=d,d}assignTexture(e,t,s,r){const n=this;return this.getDependency("texture",s.index).then(function(o){if(s.texCoord!==void 0&&s.texCoord!=0&&!(t==="aoMap"&&s.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+t+" not yet supported."),n.extensions[g.KHR_TEXTURE_TRANSFORM]){const c=s.extensions!==void 0?s.extensions[g.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const i=n.associations.get(o);o=n.extensions[g.KHR_TEXTURE_TRANSFORM].extendTexture(o,c),n.associations.set(o,i)}}return r!==void 0&&(o.encoding=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const r=t.attributes.tangent===void 0,n=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+s.uuid;let i=this.cache.get(c);i||(i=new jt,Y.prototype.copy.call(i,s),i.color.copy(s.color),i.map=s.map,i.sizeAttenuation=!1,this.cache.add(c,i)),s=i}else if(e.isLine){const c="LineBasicMaterial:"+s.uuid;let i=this.cache.get(c);i||(i=new Kt,Y.prototype.copy.call(i,s),i.color.copy(s.color),this.cache.add(c,i)),s=i}if(r||n||o){let c="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),r&&(c+="derivative-tangents:"),n&&(c+="vertex-colors:"),o&&(c+="flat-shading:");let i=this.cache.get(c);i||(i=s.clone(),n&&(i.vertexColors=!0),o&&(i.flatShading=!0),r&&(i.normalScale&&(i.normalScale.y*=-1),i.clearcoatNormalScale&&(i.clearcoatNormalScale.y*=-1)),this.cache.add(c,i),this.associations.set(i,this.associations.get(s))),s=i}s.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=s}getMaterialType(){return oe}loadMaterial(e){const t=this,s=this.json,r=this.extensions,n=s.materials[e];let o;const c={},i=n.extensions||{},u=[];if(i[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const l=r[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=l.getMaterialType(),u.push(l.extendParams(c,n,t))}else if(i[g.KHR_MATERIALS_UNLIT]){const l=r[g.KHR_MATERIALS_UNLIT];o=l.getMaterialType(),u.push(l.extendParams(c,n,t))}else{const l=n.pbrMetallicRoughness||{};if(c.color=new y(1,1,1),c.opacity=1,Array.isArray(l.baseColorFactor)){const f=l.baseColorFactor;c.color.fromArray(f),c.opacity=f[3]}l.baseColorTexture!==void 0&&u.push(t.assignTexture(c,"map",l.baseColorTexture,F)),c.metalness=l.metallicFactor!==void 0?l.metallicFactor:1,c.roughness=l.roughnessFactor!==void 0?l.roughnessFactor:1,l.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(c,"metalnessMap",l.metallicRoughnessTexture)),u.push(t.assignTexture(c,"roughnessMap",l.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,c)})))}n.doubleSided===!0&&(c.side=Bt);const d=n.alphaMode||Z.OPAQUE;if(d===Z.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,d===Z.MASK&&(c.alphaTest=n.alphaCutoff!==void 0?n.alphaCutoff:.5)),n.normalTexture!==void 0&&o!==B&&(u.push(t.assignTexture(c,"normalMap",n.normalTexture)),c.normalScale=new Oe(1,1),n.normalTexture.scale!==void 0)){const l=n.normalTexture.scale;c.normalScale.set(l,l)}return n.occlusionTexture!==void 0&&o!==B&&(u.push(t.assignTexture(c,"aoMap",n.occlusionTexture)),n.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=n.occlusionTexture.strength)),n.emissiveFactor!==void 0&&o!==B&&(c.emissive=new y().fromArray(n.emissiveFactor)),n.emissiveTexture!==void 0&&o!==B&&u.push(t.assignTexture(c,"emissiveMap",n.emissiveTexture,F)),Promise.all(u).then(function(){let l;return o===te?l=r[g.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):l=new o(c),n.name&&(l.name=n.name),N(l,n),t.associations.set(l,{materials:e}),n.extensions&&K(r,l,n),l})}createUniqueName(e){const t=Vt.sanitizeNodeName(e||"");let s=t;for(let r=1;this.nodeNamesUsed[s];++r)s=t+"_"+r;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const t=this,s=this.extensions,r=this.primitiveCache;function n(c){return s[g.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,t).then(function(i){return Ee(i,c,t)})}const o=[];for(let c=0,i=e.length;c<i;c++){const u=e[c],d=Js(u),l=r[d];if(l)o.push(l.promise);else{let f;u.extensions&&u.extensions[g.KHR_DRACO_MESH_COMPRESSION]?f=n(u):f=Ee(new $t,u,t),r[d]={primitive:u,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,s=this.json,r=this.extensions,n=s.meshes[e],o=n.primitives,c=[];for(let i=0,u=o.length;i<u;i++){const d=o[i].material===void 0?qs(this.cache):this.getDependency("material",o[i].material);c.push(d)}return c.push(t.loadGeometries(o)),Promise.all(c).then(function(i){const u=i.slice(0,i.length-1),d=i[i.length-1],l=[];for(let h=0,p=d.length;h<p;h++){const m=d[h],T=o[h];let _;const S=u[h];if(T.mode===b.TRIANGLES||T.mode===b.TRIANGLE_STRIP||T.mode===b.TRIANGLE_FAN||T.mode===void 0)_=n.isSkinnedMesh===!0?new zt(m,S):new qt(m,S),_.isSkinnedMesh===!0&&!_.geometry.attributes.skinWeight.normalized&&_.normalizeSkinWeights(),T.mode===b.TRIANGLE_STRIP?_.geometry=ye(_.geometry,ps):T.mode===b.TRIANGLE_FAN&&(_.geometry=ye(_.geometry,ke));else if(T.mode===b.LINES)_=new Xt(m,S);else if(T.mode===b.LINE_STRIP)_=new Wt(m,S);else if(T.mode===b.LINE_LOOP)_=new Jt(m,S);else if(T.mode===b.POINTS)_=new Yt(m,S);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+T.mode);Object.keys(_.geometry.morphAttributes).length>0&&Ws(_,n),_.name=t.createUniqueName(n.name||"mesh_"+e),N(_,n),T.extensions&&K(r,_,T),t.assignFinalMaterial(_),l.push(_)}for(let h=0,p=l.length;h<p;h++)t.associations.set(l[h],{meshes:e,primitives:h});if(l.length===1)return l[0];const f=new Q;t.associations.set(f,{meshes:e});for(let h=0,p=l.length;h<p;h++)f.add(l[h]);return f})}loadCamera(e){let t;const s=this.json.cameras[e],r=s[s.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new Qt(Zt.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):s.type==="orthographic"&&(t=new es(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),N(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then(function(r){return s.inverseBindMatrices=r,s})}loadAnimation(e){const s=this.json.animations[e],r=[],n=[],o=[],c=[],i=[];for(let u=0,d=s.channels.length;u<d;u++){const l=s.channels[u],f=s.samplers[l.sampler],h=l.target,p=h.node!==void 0?h.node:h.id,m=s.parameters!==void 0?s.parameters[f.input]:f.input,T=s.parameters!==void 0?s.parameters[f.output]:f.output;r.push(this.getDependency("node",p)),n.push(this.getDependency("accessor",m)),o.push(this.getDependency("accessor",T)),c.push(f),i.push(h)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(o),Promise.all(c),Promise.all(i)]).then(function(u){const d=u[0],l=u[1],f=u[2],h=u[3],p=u[4],m=[];for(let _=0,S=d.length;_<S;_++){const x=d[_],G=l[_],v=f[_],w=h[_],R=p[_];if(x===void 0)continue;x.updateMatrix(),x.matrixAutoUpdate=!0;let D;switch(I[R.path]){case I.weights:D=gs;break;case I.rotation:D=ge;break;case I.position:case I.scale:default:D=ms;break}const U=x.name?x.name:x.uuid,ze=w.interpolation!==void 0?zs[w.interpolation]:De,z=[];I[R.path]===I.weights?x.traverse(function(M){M.morphTargetInfluences&&z.push(M.name?M.name:M.uuid)}):z.push(U);let k=v.array;if(v.normalized){const M=ne(k.constructor),q=new Float32Array(k.length);for(let C=0,le=k.length;C<le;C++)q[C]=k[C]*M;k=q}for(let M=0,q=z.length;M<q;M++){const C=new D(z[M]+"."+I[R.path],G.array,k,ze);w.interpolation==="CUBICSPLINE"&&(C.createInterpolant=function(qe){const Xe=this instanceof ge?$s:ie;return new Xe(this.times,this.values,this.getValueSize()/3,qe)},C.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),m.push(C)}}const T=s.name?s.name:"animation_"+e;return new ts(T,void 0,m)})}createNodeMesh(e){const t=this.json,s=this,r=t.nodes[e];return r.mesh===void 0?null:s.getDependency("mesh",r.mesh).then(function(n){const o=s._getNodeRef(s.meshCache,r.mesh,n);return r.weights!==void 0&&o.traverse(function(c){if(c.isMesh)for(let i=0,u=r.weights.length;i<u;i++)c.morphTargetInfluences[i]=r.weights[i]}),o})}loadNode(e){const t=this.json,s=this.extensions,r=this,n=t.nodes[e],o=n.name?r.createUniqueName(n.name):"";return function(){const c=[],i=r._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return i&&c.push(i),n.camera!==void 0&&c.push(r.getDependency("camera",n.camera).then(function(u){return r._getNodeRef(r.cameraCache,n.camera,u)})),r._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){c.push(u)}),Promise.all(c)}().then(function(c){let i;if(n.isBone===!0?i=new ss:c.length>1?i=new Q:c.length===1?i=c[0]:i=new ns,i!==c[0])for(let u=0,d=c.length;u<d;u++)i.add(c[u]);if(n.name&&(i.userData.name=n.name,i.name=o),N(i,n),n.extensions&&K(s,i,n),n.matrix!==void 0){const u=new Ue;u.fromArray(n.matrix),i.applyMatrix4(u)}else n.translation!==void 0&&i.position.fromArray(n.translation),n.rotation!==void 0&&i.quaternion.fromArray(n.rotation),n.scale!==void 0&&i.scale.fromArray(n.scale);return r.associations.has(i)||r.associations.set(i,{}),r.associations.get(i).nodes=e,i})}loadScene(e){const t=this.json,s=this.extensions,r=this.json.scenes[e],n=this,o=new Q;r.name&&(o.name=n.createUniqueName(r.name)),N(o,r),r.extensions&&K(s,o,r);const c=r.nodes||[],i=[];for(let u=0,d=c.length;u<d;u++)i.push(Ge(c[u],o,t,n,u));return Promise.all(i).then(function(){const u=l=>{const f=new Map;for(const[h,p]of n.associations)(h instanceof Y||h instanceof me)&&f.set(h,p);return l.traverse(h=>{const p=n.associations.get(h);p!=null&&f.set(h,p)}),f};n.associations=u(o);function d(l){if(l.children&&l.children.length){const f=l.children,h=new Array(f.length).fill(void 0);let p=!0;for(const m of f)if(m.parentIndex===void 0){p=!1;break}else h[m.parentIndex]=m,delete m.parentIndex,d(m);p?l.children=h:p=!0}}return d(o),o})}}function Ge(a,e,t,s,r){const n=t.nodes[a];return s.getDependency("node",a).then(function(o){if(n.skin===void 0)return o;let c;return s.getDependency("skin",n.skin).then(function(i){c=i;const u=[];for(let d=0,l=c.joints.length;d<l;d++)u.push(s.getDependency("node",c.joints[d]));return Promise.all(u)}).then(function(i){return o.traverse(function(u){if(!u.isMesh)return;const d=[],l=[];for(let f=0,h=i.length;f<h;f++){const p=i[f];if(p){d.push(p);const m=new Ue;c.inverseBindMatrices!==void 0&&m.fromArray(c.inverseBindMatrices.array,f*16),l.push(m)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',c.joints[f])}u.bind(new rs(d,l),u.matrixWorld)}),o})}).then(function(o){o.parentIndex=r,e.add(o);const c=[];if(n.children){const i=n.children;for(let u=0,d=i.length;u<d;u++){const l=i[u];c.push(Ge(l,o,t,s,u))}}return Promise.all(c)})}function Zs(a,e,t){const s=e.attributes,r=new _s;if(s.POSITION!==void 0){const c=t.json.accessors[s.POSITION],i=c.min,u=c.max;if(i!==void 0&&u!==void 0){if(r.set(new X(i[0],i[1],i[2]),new X(u[0],u[1],u[2])),c.normalized){const d=ne(V[c.componentType]);r.min.multiplyScalar(d),r.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const n=e.targets;if(n!==void 0){const c=new X,i=new X;for(let u=0,d=n.length;u<d;u++){const l=n[u];if(l.POSITION!==void 0){const f=t.json.accessors[l.POSITION],h=f.min,p=f.max;if(h!==void 0&&p!==void 0){if(i.setX(Math.max(Math.abs(h[0]),Math.abs(p[0]))),i.setY(Math.max(Math.abs(h[1]),Math.abs(p[1]))),i.setZ(Math.max(Math.abs(h[2]),Math.abs(p[2]))),f.normalized){const m=ne(V[f.componentType]);i.multiplyScalar(m)}c.max(i)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(c)}a.boundingBox=r;const o=new xs;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,a.boundingSphere=o}function Ee(a,e,t){const s=e.attributes,r=[];function n(o,c){return t.getDependency("accessor",o).then(function(i){a.setAttribute(c,i)})}for(const o in s){const c=se[o]||o.toLowerCase();c in a.attributes||r.push(n(s[o],c))}if(e.indices!==void 0&&!a.index){const o=t.getDependency("accessor",e.indices).then(function(c){a.setIndex(c)});r.push(o)}return N(a,e),Zs(a,e,t),Promise.all(r).then(function(){return e.targets!==void 0?Xs(a,e.targets,t):a})}function ye(a,e){let t=a.getIndex();if(t===null){const o=[],c=a.getAttribute("position");if(c!==void 0){for(let i=0;i<c.count;i++)o.push(i);a.setIndex(o),t=a.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}const s=t.count-2,r=[];if(e===ke)for(let o=1;o<=s;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<s;o++)o%2===0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const n=a.clone();return n.setIndex(r),n}Object.values(Tt).forEach(a=>{_t.register(a)});Object.values(xt).forEach(a=>{St.register(a)});window.VIS={};Rt({proxy:{expand:$.observable,timing:"before"}});const E=new Rs().install(ys()),H=new ws;H.setDRACOLoader(new Et);H.setKTX2Loader(new yt);H.setMeshoptDecoder(wt);H.dracoLoader.setDecoderPath("plugins/draco/gltf/");E.loaderManager.register("gltf",H).register("glb",H);E.eventManager.recursive=!0;window.VIS.engine=E;var en=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0},ae={},tn=Object.prototype.hasOwnProperty,sn;function we(a){try{return decodeURIComponent(a.replace(/\+/g," "))}catch{return null}}function Me(a){try{return encodeURIComponent(a)}catch{return null}}function nn(a){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},s;s=e.exec(a);){var r=we(s[1]),n=we(s[2]);r===null||n===null||r in t||(t[r]=n)}return t}function rn(a,e){e=e||"";var t=[],s,r;typeof e!="string"&&(e="?");for(r in a)if(tn.call(a,r)){if(s=a[r],!s&&(s===null||s===sn||isNaN(s))&&(s=""),r=Me(r),s=Me(s),r===null||s===null)continue;t.push(r+"="+s)}return t.length?e+t.join("&"):""}ae.stringify=rn;ae.parse=nn;var je=en,J=ae,on=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,Ke=/[\n\r\t]/g,an=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,Be=/:\d+$/,cn=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,ln=/^[a-zA-Z]:/;function ce(a){return(a||"").toString().replace(on,"")}var re=[["#","hash"],["?","query"],function(e,t){return A(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],Ae={hash:1,query:1};function Ve(a){var e;typeof window<"u"?e=window:typeof fe<"u"?e=fe:typeof self<"u"?e=self:e={};var t=e.location||{};a=a||t;var s={},r=typeof a,n;if(a.protocol==="blob:")s=new L(unescape(a.pathname),{});else if(r==="string"){s=new L(a,{});for(n in Ae)delete s[n]}else if(r==="object"){for(n in a)n in Ae||(s[n]=a[n]);s.slashes===void 0&&(s.slashes=an.test(a.href))}return s}function A(a){return a==="file:"||a==="ftp:"||a==="http:"||a==="https:"||a==="ws:"||a==="wss:"}function $e(a,e){a=ce(a),a=a.replace(Ke,""),e=e||{};var t=cn.exec(a),s=t[1]?t[1].toLowerCase():"",r=!!t[2],n=!!t[3],o=0,c;return r?n?(c=t[2]+t[3]+t[4],o=t[2].length+t[3].length):(c=t[2]+t[4],o=t[2].length):n?(c=t[3]+t[4],o=t[3].length):c=t[4],s==="file:"?o>=2&&(c=c.slice(2)):A(s)?c=t[4]:s?r&&(c=c.slice(2)):o>=2&&A(e.protocol)&&(c=t[4]),{protocol:s,slashes:r||A(s),slashesCount:o,rest:c}}function un(a,e){if(a==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(a.split("/")),s=t.length,r=t[s-1],n=!1,o=0;s--;)t[s]==="."?t.splice(s,1):t[s]===".."?(t.splice(s,1),o++):o&&(s===0&&(n=!0),t.splice(s,1),o--);return n&&t.unshift(""),(r==="."||r==="..")&&t.push(""),t.join("/")}function L(a,e,t){if(a=ce(a),a=a.replace(Ke,""),!(this instanceof L))return new L(a,e,t);var s,r,n,o,c,i,u=re.slice(),d=typeof e,l=this,f=0;for(d!=="object"&&d!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=J.parse),e=Ve(e),r=$e(a||"",e),s=!r.protocol&&!r.slashes,l.slashes=r.slashes||s&&e.slashes,l.protocol=r.protocol||e.protocol||"",a=r.rest,(r.protocol==="file:"&&(r.slashesCount!==2||ln.test(a))||!r.slashes&&(r.protocol||r.slashesCount<2||!A(l.protocol)))&&(u[3]=[/(.*)/,"pathname"]);f<u.length;f++){if(o=u[f],typeof o=="function"){a=o(a,l);continue}n=o[0],i=o[1],n!==n?l[i]=a:typeof n=="string"?(c=n==="@"?a.lastIndexOf(n):a.indexOf(n),~c&&(typeof o[2]=="number"?(l[i]=a.slice(0,c),a=a.slice(c+o[2])):(l[i]=a.slice(c),a=a.slice(0,c)))):(c=n.exec(a))&&(l[i]=c[1],a=a.slice(0,c.index)),l[i]=l[i]||s&&o[3]&&e[i]||"",o[4]&&(l[i]=l[i].toLowerCase())}t&&(l.query=t(l.query)),s&&e.slashes&&l.pathname.charAt(0)!=="/"&&(l.pathname!==""||e.pathname!=="")&&(l.pathname=un(l.pathname,e.pathname)),l.pathname.charAt(0)!=="/"&&A(l.protocol)&&(l.pathname="/"+l.pathname),je(l.port,l.protocol)||(l.host=l.hostname,l.port=""),l.username=l.password="",l.auth&&(c=l.auth.indexOf(":"),~c?(l.username=l.auth.slice(0,c),l.username=encodeURIComponent(decodeURIComponent(l.username)),l.password=l.auth.slice(c+1),l.password=encodeURIComponent(decodeURIComponent(l.password))):l.username=encodeURIComponent(decodeURIComponent(l.auth)),l.auth=l.password?l.username+":"+l.password:l.username),l.origin=l.protocol!=="file:"&&A(l.protocol)&&l.host?l.protocol+"//"+l.host:"null",l.href=l.toString()}function dn(a,e,t){var s=this;switch(a){case"query":typeof e=="string"&&e.length&&(e=(t||J.parse)(e)),s[a]=e;break;case"port":s[a]=e,je(e,s.protocol)?e&&(s.host=s.hostname+":"+e):(s.host=s.hostname,s[a]="");break;case"hostname":s[a]=e,s.port&&(e+=":"+s.port),s.host=e;break;case"host":s[a]=e,Be.test(e)?(e=e.split(":"),s.port=e.pop(),s.hostname=e.join(":")):(s.hostname=e,s.port="");break;case"protocol":s.protocol=e.toLowerCase(),s.slashes=!t;break;case"pathname":case"hash":if(e){var r=a==="pathname"?"/":"#";s[a]=e.charAt(0)!==r?r+e:e}else s[a]=e;break;case"username":case"password":s[a]=encodeURIComponent(e);break;case"auth":var n=e.indexOf(":");~n?(s.username=e.slice(0,n),s.username=encodeURIComponent(decodeURIComponent(s.username)),s.password=e.slice(n+1),s.password=encodeURIComponent(decodeURIComponent(s.password))):s.username=encodeURIComponent(decodeURIComponent(e))}for(var o=0;o<re.length;o++){var c=re[o];c[4]&&(s[c[1]]=s[c[1]].toLowerCase())}return s.auth=s.password?s.username+":"+s.password:s.username,s.origin=s.protocol!=="file:"&&A(s.protocol)&&s.host?s.protocol+"//"+s.host:"null",s.href=s.toString(),s}function fn(a){(!a||typeof a!="function")&&(a=J.stringify);var e,t=this,s=t.host,r=t.protocol;r&&r.charAt(r.length-1)!==":"&&(r+=":");var n=r+(t.protocol&&t.slashes||A(t.protocol)?"//":"");return t.username?(n+=t.username,t.password&&(n+=":"+t.password),n+="@"):t.password?(n+=":"+t.password,n+="@"):t.protocol!=="file:"&&A(t.protocol)&&!s&&t.pathname!=="/"&&(n+="@"),(s[s.length-1]===":"||Be.test(t.hostname)&&!t.port)&&(s+=":"),n+=s+t.pathname,e=typeof t.query=="object"?a(t.query):t.query,e&&(n+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(n+=t.hash),n}L.prototype={set:dn,toString:fn};L.extractProtocol=$e;L.location=Ve;L.trimLeft=ce;L.qs=J;var hn=L;const pn=Mt(hn);var mn=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"renderWindow-container"},[t("iframe",{ref:"renderMask",staticClass:"render-mask",attrs:{width:"100%",height:"100%",scrolling:"no"}}),t("div",{ref:"renderElement",staticClass:"render-window",attrs:{tabindex:"0"}})])},gn=[];const Tn={data(){return{timer:"",canResize:!0,throttleTime:1e3/60}},methods:{},async mounted(){E.setDom(this.$refs.renderElement).setSize().play(),this.$watch("play",u=>{u?E.play():E.stop()},{immediate:!0});const a=this.$refs.renderMask;a.contentWindow.addEventListener("resize",u=>{if(this.canResize)this.canResize=!1,this.timer=setTimeout(()=>{E.setSize(a.offsetWidth,a.offsetHeight),this.canResize=!0},this.throttleTime);else return!1});const e=this.$loading({text:"...",background:"rgba(0, 0, 0, 0.3)"}),s=pn(window.location.href,!0).query.id;s||(this.$message.warning(""),e.close(),window.close());let n=(await At.getApp(s).catch(u=>{this.$message.error(u),e.close()})).app||{};delete n.helper;let o=JSON.stringify(n,he.stringify);!n.assets&&(n.assets=[]);const c=[];n.assets.forEach(u=>{u.module==="model"?c.push(new Promise((d,l)=>{Lt.getModel(u.id).then(f=>{const h=URL.createObjectURL(f.model);o=o.replace(new RegExp(`<${u.module}-${u.id}>`,"g"),h),d({url:h,ext:f.ext})}).catch(l)})):u.module==="texture"&&c.push(new Promise((d,l)=>{bt.getTexture(u.id).then(f=>{const h=URL.createObjectURL(f.texture);o=o.replace(new RegExp(`<${u.module}-${u.id}>`,"g"),h),d({url:h,ext:f.ext})}).catch(l)}))}),!n.component&&(n.component=[]);const i=[];n.component.forEach(u=>{const[d,l]=u.$url.slice(1,-1).split("-");i.push(new Promise((f,h)=>{Ct.getComponent(l).then(p=>{const m=URL.createObjectURL(p.component);o=o.replace(new RegExp(`<${d}-${l}>`,"g"),m),u.$url=m,u.$pkg=p.pkg,f(u)})}))}),n.assets=await Promise.all(c),n.component=await Promise.all(i),o=JSON.parse(o,he.parse),o.assets=n.assets,o.component=n.component,n=o,n=It.handler(n,u=>vt(u.type,u,{strict:!1}),{filter:["assets","component"]}),await E.loadConfigAsync(n),E.setSceneBySymbol(n.scene[0].vid),E.play(),e.close()}},Le={};var _n=W(Tn,mn,gn,!1,xn,"324ad53b",null,null);function xn(a){for(let e in Le)this[e]=Le[e]}const Sn=function(){return _n.exports}();var Rn=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"icon-container",style:{"font-size":a.size,color:a.color}},[t("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[t("use",{attrs:{"xlink:href":a.code}})])])},En=[];const yn={name:"vis-icon",props:{code:{type:String},size:{type:String},color:{type:String}},data(){return{}},mounted(){},beforeDestroy(){}},be={};var wn=W(yn,Rn,En,!1,Mn,null,null,null);function Mn(a){for(let e in be)this[e]=be[e]}const An=function(){return wn.exports}();var Ln=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{directives:[{name:"show",rawName:"v-show",value:a.showLoading,expression:"showLoading"}],staticClass:"loadingManager-container"},[t("div",{staticClass:"loadingManage-main"},[a.loadError?t("div",{staticClass:"loadingManager-close",on:{click:a.close}},[t("vis-icon",{attrs:{code:"#iconguanbi"}})],1):a._e(),t("div",{staticClass:"progress-title"},[t("vis-icon",{attrs:{code:"#iconwenjian"}}),a._v(" "+a._s(a.title)+" ")],1),t("div",{staticClass:"overall-progress-box"},[t("div",{staticClass:"overall-progress"},[t("div",{staticClass:"overall-progress-main",style:{width:`${a.overllProgress}%`,backgroundColor:a.loadError?"#FF4C4C":null}})]),t("span",{staticClass:"overall-number",domProps:{textContent:a._s(`${a.loadSuccess}/${a.loadTotal}`)}})]),t("div",{staticClass:"detail-progress-box"},[t("div",{staticClass:"detail-title",on:{click:function(){a.showDetail=!a.showDetail}}},[t("span",[a._v("")]),t("vis-icon",{style:{transform:a.showDetail?"rotate(0)":"rotate(-90deg)"},attrs:{code:"#iconxiala"}})],1),a.showDetail?t("div",{staticClass:"detail-message"},a._l(a.loadDetailMap,function(s,r){return t("div",{key:r,staticClass:"detail-item",style:{color:s.error?"#FF4C4C":null}},[t("span",{staticClass:"detail-url",domProps:{textContent:a._s(s.url)}}),s.error?t("span",{domProps:{textContent:a._s(s.message)}}):[t("span",{staticClass:"detail-seat"}),t("span",{staticClass:"detail-number",domProps:{textContent:a._s(`${s.progress*100}%`)}})]],2)}),0):a._e()])])])},bn=[];const Cn={components:{visIcon:An},data(){return{showLoading:!1,showDetail:!0,title:"",loadTotal:0,loadSuccess:0,loadError:0,loadDetailMap:{}}},computed:{overllProgress(){return this.loadTotal===0?0:this.loadSuccess/this.loadTotal*100}},methods:{close(){this.showLoading=!1}},mounted(){const a=E.loaderManager;a.addEventListener("beforeLoad",e=>{!this.showLoading&&(this.showLoading=!0)}),a.addEventListener("loading",e=>{!this.showLoading&&(this.showLoading=!0),this.loadTotal=e.loadTotal,this.loadSuccess=e.loadSuccess,this.loadError=e.loadError}),a.addEventListener("loaded",e=>{this.loadTotal=e.loadTotal,this.loadSuccess=e.loadSuccess,this.loadError=e.loadError,setTimeout(()=>{this.showLoading=!1},1e3)}),a.addEventListener("detailLoaded",e=>{this.title=e.url,this.loadDetailMap=a.getLoadDetailMap()})}},Ce={};var In=W(Cn,Ln,bn,!1,vn,"b696a558",null,null);function vn(a){for(let e in Ce)this[e]=Ce[e]}const Nn=function(){return In.exports}();var On=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{attrs:{id:"app"}},[t("render-window")],1)},Fn=[];const Pn={components:{renderWindow:Sn,loadingManager:Nn},mounted(){}},Ie={};var Dn=W(Pn,On,Fn,!1,Un,"898a24f8",null,null);function Un(a){for(let e in Ie)this[e]=Ie[e]}const kn=function(){return Dn.exports}();ve.start();$.config.productionTip=!1;$.use(Nt);new $({render:a=>a(kn),mounted(){ve.done()}}).$mount("#app");
